$(function(){function e(){console.log("HEY LISTEN"),console.log(io),void 0==io&&N({title:"Could not connect to server",content:"<p>You need to restart the app</p><p><button class='button' onclick='location.reload()'><i class='material-icons'>refresh</i></button></p>"})}function n(){console.log("opening page CONTACTS"),P=b.CONTACTS,i(),$("#setup").removeClass("active"),$("#conversation").removeClass("active"),$("#conversation-list").addClass("active")}function t(){console.log("opening page CHAT"),P=b.CHAT,M.removeClass("active"),w.addClass("active"),O.removeClass("active"),s()}function o(){console.log("opening page SIGNUP"),P=b.SIGNUP,M.addClass("active"),w.removeClass("active"),O.removeClass("active"),r()}function a(){localStorage.username=void 0,H=void 0,Y=!1,o()}function i(){$("#conversation-list .greetings .name").text(H),console.log("Getting friendslist"),D.emit("get friendslist")}function s(){$(".messages .info .name").text(L)}function r(){}function l(){H=p(I.val().trim()),H&&(Y=!0,D.emit("register",{username:H}))}function c(){var e=p($("#friendInput").val().trim());e&&(console.log("Adding Friend: "+e),D.emit("add friend",{friend:e}))}function u(){var e=k.val();e=p(e),e&&(g({username:"",message:e}),D.emit("send message",{message:e,targetUser:L}))}function g(e){var n=$('<span class="username"/>').text(e.username),t=$('<span class="messageBody">').text(e.message),o=$('<li class="message"/>').data("username",e.username).addClass(typingClass).append(n,t);v(o)}function d(){Y&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(m,f,{}),setTimeout(d,5e3)}function m(e){var n=e.coords.latitude,t=e.coords.longitude;D.emit("update location",{lat:n,lng:t})}function f(e){alert(e)}function v(e){var n=$(e);T[0].scrollTop=T[0].scrollHeight}function p(e){return $("<div/>").text(e).text()}function C(e){console.log("Opening alert "+e.title),$("#genericAlert .title").html(e.title),$("#genericAlert .content").html(e.content),$("#genericAlert").foundation("open")}function N(e){console.log("Opening error "+e.title),$("#genericError .title").html(e.title),$("#genericError .content").html(e.content),$("#genericError").foundation("open")}var h=150,S="http://localhost:3000/",b={SIGNUP:0,CONTACTS:1,CHAT:2},y=$(window),I=$("#usernameInput"),A=$("#registerUsernameInput"),T=$(".messages"),k=$(".inputMessage"),x=$("#setNamesButton");newphotoDiv=document.getElementById("newPhoto");var w=$("#conversation"),B=$("#conversation.bottom-bar.sendMessageInterface"),U=$("#conversation.bottom-bar.unavaliableInterface"),F=$("#conversation.chatArea.your-name.username"),O=$("#conversation-list"),E=$("#friendInput"),G=$("#contacts-list"),M=$("#setup"),P=b.SIGNUP,H,L,Y=!1;$(document).ready(function(){e()});var D=io.connect(S);D.on("connect",function(){void 0!=localStorage.username?(console.log("Trying to login with found username "+localStorage.username),D.emit("login",{username:localStorage.username})):(console.log("Not logged in."),o()),d()}),$("#sendMessageButton").click(function(){u()}),$("#changeNameButton").click(function(){l()}),$("#setNamesButton").click(function(){H=p($("#registerUsernameInput").val().trim()),H&&(Y=!0,D.emit("register",{username:H}))}),$("#convo-back").click(function(){n()}),$("#registerUsernameInput").submit(function(){}),$("#addFriendButton").click(function(){c()}),$("#refreshFriendsList").click(function(){i()}),$("#logoutButton").click(function(){console.log("Logging out"),a()}),D.on("login result",function(e){e.success?(Y=!0,H=e.username,localStorage.username=H,console.log("Logged in as: "+e.username),n()):(console.log("login failed "+e),N({title:"Login Failure",content:e.errorMessage}),o())}),D.on("available",function(e){}),D.on("friendslist",function(e){if(G.empty(),console.log("got datas "+JSON.stringify(e)+" of "+typeof e),0==e.length)console.log("You have no friends.");else for(var n=0;n<e.length;n++){var o=e[n];console.log("Got friend "+o.friendName);var a=$('<span class="name"/>').text(o.friendName),i="contact ";if(o.friendAvaliability){var s=$('<span class="status">').text("in your area");i+="avaliable"}else{var s=$('<span class="status">').text("away");i+="away"}var r=$('<li class="'+i+'"/>').data("friendName",o.friendName).append(a,s).click(function(){console.log("Opening conversation between"+o.friendName),L=o.friendName,t()});G.append(r)}}),D.on("add friend result",function(e){C(e.friendAdded?{title:"Friend added!",content:""}:{title:"Friend not found",content:e.errorMessage})}),D.on("incoming message",function(e){console.log("got message "+e),g(e)}),D.on("register result",function(e){console.log("register result"+e),e.success?(H=e.username,localStorage.username=H,Y=!0,n()):(console.log("register failed "+e),N({title:"Registration Failure",content:e.errorMessage}),o())}),$(document).ready(function(){e()})});