$(function(){function e(){console.log("HEY LISTEN"),console.log(io),void 0==io&&h({title:"Could not connect to server",content:"<p>You need to restart the app</p><p><button class='button' onclick='location.reload()'><i class='material-icons'>refresh</i></button></p>"})}function n(){console.log("opening page CONTACTS"),P=S.CONTACTS,G.removeClass("active"),x.removeClass("active"),O.addClass("active"),s()}function o(){console.log("opening page CHAT"),P=S.CHAT,G.removeClass("active"),x.addClass("active"),MotionUI.animateIn(x,"slide-in",function(){console.log("Transition finished!")}),O.removeClass("active"),a()}function t(){console.log("opening page SIGNUP"),P=S.SIGNUP,G.addClass("active"),MotionUI.animateIn(G,"slide-in",function(){console.log("Transition finished!")}),x.removeClass("active"),O.removeClass("active"),r()}function i(){localStorage.username=void 0,H=void 0,Y=!1,t()}function s(){$("#conversation-list .greetings .name").text(H),console.log("Getting friendslist"),D.emit("get friendslist")}function a(){$(".messages .info .name").text(L)}function r(){}function c(){H=p(b.val().trim()),H&&(Y=!0,D.emit("register",{username:H}))}function l(){var e=p($("#friendInput").val().trim());e&&(console.log("Adding Friend: "+e),D.emit("add friend",{friend:e}))}function u(){var e=k.val();e=p(e),e&&D.emit("send message",{message:e,targetUser:L})}function g(e){var n=$('<span class="username"/>').text(e.username),o=$('<span class="messageBody">').text(e.message),t=$('<li class="message"/>').data("username",e.username).addClass(typingClass).append(n,o);v(t)}function d(){Y&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(m,f,{}),setTimeout(d,5e3)}function m(e){var n=e.coords.latitude,o=e.coords.longitude;D.emit("update location",{lat:n,lng:o})}function f(e){alert(e)}function v(e){var n=$(e);y[0].scrollTop=y[0].scrollHeight}function p(e){return $("<div/>").text(e).text()}function C(e){console.log("Opening alert "+e.title),$("#genericAlert .title").html(e.title),$("#genericAlert .content").html(e.content),$("#genericAlert").foundation("open")}function h(e){console.log("Opening error "+e.title),$("#genericError .title").html(e.title),$("#genericError .content").html(e.content),$("#genericError").foundation("open")}var N=150,I="http://localhost:3000/",S={SIGNUP:0,CONTACTS:1,CHAT:2},T=$(window),b=$("#usernameInput"),A=$("#registerUsernameInput"),y=$(".messages"),k=$(".inputMessage"),U=$("#setNamesButton");newphotoDiv=document.getElementById("newPhoto");var x=$("#conversation"),B=$("#conversation.bottom-bar.sendMessageInterface"),M=$("#conversation.bottom-bar.unavaliableInterface"),F=$("#conversation.chatArea.your-name.username"),O=$("#conversation-list"),w=$("#friendInput"),E=$("#contacts-list"),G=$("#setup"),P=S.SIGNUP,H,L,Y=!1;$(document).ready(function(){e()});var D=io.connect(I);D.on("connect",function(){void 0!=localStorage.username?(console.log("Trying to login with found username "+localStorage.username),D.emit("login",{username:localStorage.username})):(console.log("Not logged in."),t()),d()}),$("#sendMessageButton").click(function(){u()}),$("#changeNameButton").click(function(){c()}),$("#setNamesButton").click(function(){H=p($("#registerUsernameInput").val().trim()),H&&(Y=!0,D.emit("register",{username:H}))}),$("#convo-back").click(function(){n()}),$("#registerUsernameInput").submit(function(){}),$("#addFriendButton").click(function(){l()}),$("#refreshFriendsList").click(function(){s()}),$("#logoutButton").click(function(){console.log("Logging out"),i()}),D.on("login result",function(e){e.success?(Y=!0,H=e.username,localStorage.username=H,console.log("Logged in as: "+e.username),n()):(console.log("login failed "+e),h({title:"Login Failure",content:e.errorMessage}),t())}),D.on("available",function(e){}),D.on("friendslist",function(e){if(E.empty(),console.log("got datas "+JSON.stringify(e)+" of "+typeof e),0==e.length)console.log("You have no friends.");else for(var n in e){console.log("Got friend "+n.friendName);var t=$('<span class="name"/>').text(n.friendName),i=$('<span class="status">').text(n.friendAvaliability),s=$('<li class="contact"/>').data("friendName",n.friendName).append(t,i).click(function(){console.log("Opening conversation between"+n.friendName),L=n.friendName,o()});E.append(s)}}),D.on("add friend result",function(e){C(e.friendAdded?{title:"Friend added!",content:""}:{title:"Friend not found",content:e.errorMessage})}),D.on("incoming message",function(e){console.log("got message "+e),g(e)}),D.on("register result",function(e){console.log("register result"+e),e.success?(H=e.username,localStorage.username=H,Y=!0,n()):(console.log("register failed "+e),h({title:"Registration Failure",content:e.errorMessage}),t())}),$(document).ready(function(){e()})});