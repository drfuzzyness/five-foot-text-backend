$(function(){function e(){}function n(){L.removeClass("active"),x.removeClass("active"),w.addClass("active"),a()}function t(){L.removeClass("active"),x.addClass("active"),w.removeClass("active"),s()}function o(){L.addClass("active"),x.removeClass("active"),w.removeClass("active"),i()}function a(){console.log("Refreshing login page")}function s(){console.log("Getting friendslist"),R.emit("get friendslist")}function i(){}function r(){T=v(y.val().trim()),T&&(G=!0,R.emit("register",{username:T}))}function c(){var e=v($("#friendInput").val().trim());console.log("Adding Friend: "+e),e&&R.emit("add friend",{friend:e})}function l(){var e=I.val();e=v(e),e&&R.emit("send message",{message:e,targetUser:U})}function u(e,n){var t=$('<span class="username"/>').text(e.username),o=$('<span class="messageBody">').text(e.message),a=$('<li class="message"/>').data("username",e.username).addClass(typingClass).append(t,o);m(a,n)}function d(){G&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(g,f,{}),setTimeout(d,5e3)}function g(e){var n=e.coords.latitude,t=e.coords.longitude;R.emit("update location",{lat:n,lng:t})}function f(e){alert(e)}function m(e,n){var t=$(e);n||(n={}),"undefined"==typeof n.fade&&(n.fade=!0),"undefined"==typeof n.prepend&&(n.prepend=!1),n.fade,n.prepend?h.prepend(t):h.append(t),h[0].scrollTop=h[0].scrollHeight}function v(e){return $("<div/>").text(e).text()}var p=150,C="http://172.26.101.113:3000/",N=$(window),y=$("#usernameInput"),b=$("#registerUsernameInput"),h=$(".messages"),I=$(".inputMessage"),k=$("#setNamesButton"),x=$("#conversation"),B=$("#conversation.bottom-bar.sendMessageInterface"),F=$("#conversation.bottom-bar.unavaliableInterface"),M=$("#conversation.chatArea.your-name.username"),w=$("#conversation-list"),S=$("#friendInput"),A=$("#contacts-list"),L=$("#setup"),T,U,G=!1,R=io.connect(C);R.on("connect",function(){void 0!=localStorage.username?(console.log("Trying to login with found username "+localStorage.username),R.emit("login",{username:localStorage.username})):(console.log("Not logged in."),o()),d()}),$("#sendMessageButton").click(function(){l()}),$("#changeNameButton").click(function(){r()}),$("#setNamesButton").click(function(){T=v($("#registerUsernameInput").val().trim()),T&&(G=!0,R.emit("register",{username:T}))}),$("#addFriendButton").click(function(){c()}),$("#refreshFriendsList").click(function(){s()}),R.on("login result",function(e){e.success?(G=!0,T=e.username,console.log("Logged in as: "+e.username),n()):(alert("Login Fail: "+e.errorMessage),o())}),R.on("available",function(e){}),R.on("friendslist",function(e){if(A.empty(),console.log(e),0==e.size())console.log("You have no friends.");else for(var n in e){console.log("Got friend "+n.friendName);var o=$('<span class="name"/>').text(n.friendName),a=$('<span class="status">').text(n.friendAvaliability),s=$('<li class="contact"/>').data("friendName",n.friendName).append(o,a).click(function(){console.log("Opening conversation between"+n.friendName),U=n.friendName,t()});A.append(s)}}),R.on("incoming message",function(e){console.log("got message "+e),u(e)}),R.on("register result",function(e){console.log("register result"+e),e.success?(T=e.username,localStorage.username=T,G=!0,n()):(alert("Register Fail: "+e.errorMessage),o())}),$(document).ready(function(){e()})});