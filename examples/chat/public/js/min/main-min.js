$(function(){function e(e){var n="";n+=1===e.numUsers?"there's 1 participant":"there are "+e.numUsers+" participants",o(n)}function n(){k=f(h.val().trim()),K=f(w.val().trim()),localStorage.setItem("username",k),k&&K&&(I.removeClass("active"),T.addClass("active"),O.emit("add user",{username:k,friend:K,location:location}))}function t(){navigator.geolocation?navigator.geolocation.getCurrentPosition(a):alert("Geolocation is not supported by this browser.")}function a(e){j=e}function i(){var e=C.val();e=f(e),e&&B&&(C.val(""),s({username:k,friend:K,location:location,message:e}),O.emit("new message",{message:e,friend:K}))}function o(e,n){var t=$("<li>").addClass("log").text(e);c(t,n)}function s(e,n){var t=d(e);n=n||{},0!==t.length&&(n.fade=!1,t.remove());var a=$('<span class="username"/>').text(e.username).css("color",m(e.username)),i=$('<span class="messageBody">').text(e.message),o=e.typing?"typing":"",s=$('<li class="message"/>').data("username",e.username).addClass(o).append(a,i);c(s,n)}function r(e){e.typing=!0,e.message="is typing",s(e)}function u(e){d(e).fadeOut(function(){$(this).remove()})}function c(e,n){var t=$(e);n||(n={}),"undefined"==typeof n.fade&&(n.fade=!0),"undefined"==typeof n.prepend&&(n.prepend=!1),n.fade&&t.hide().fadeIn(l),n.prepend?b.prepend(t):b.append(t),b[0].scrollTop=b[0].scrollHeight}function f(e){return $("<div/>").text(e).text()}function p(){B&&(D||(D=!0,O.emit("typing")),M=(new Date).getTime(),setTimeout(function(){var e=(new Date).getTime(),n=e-M;n>=g&&D&&(O.emit("stop typing"),D=!1)},g))}function d(e){return $(".typing.message").filter(function(n){return $(this).data("username")===e.username})}function m(e){for(var n=7,t=0;t<e.length;t++)n=e.charCodeAt(t)+(n<<5)-n;var a=Math.abs(n%v.length);return v[a]}var l=150,g=400,v=["#e21400","#91580f","#f8a700","#f78b00","#58dc00","#287b00","#a8f07a","#4ae8c4","#3b88eb","#3824aa","#a700ff","#d300e7"],y=$(window),h=$("#usernameInput"),w=$("#friendInput"),b=$(".messages"),C=$(".inputMessage"),x=$("#setNamesButton"),I=$("#setup"),T=$(".conversation"),k,K,j,B=!1,D=!1,M,O=io();y.keydown(function(e){!(e.ctrlKey||e.metaKey||e.altKey),13===e.which&&(k?(i(),O.emit("stop typing"),D=!1):n())}),x.on("click",function(){n()}),C.on("input",function(){p()}),O.on("login",function(n){B=!0;var t="Welcome to Socket.IO Chat â€“ ";o(t,{prepend:!0}),e(n)}),O.on("new message",function(e){s(e)}),O.on("user joined",function(n){o(n.username+" joined"),e(n)}),O.on("user left",function(n){o(n.username+" left"),e(n),u(n)}),O.on("typing",function(e){r(e)}),O.on("stop typing",function(e){u(e)})});